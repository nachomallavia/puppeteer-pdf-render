{"version":3,"file":"main.js","mappings":"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","sources":["webpack://puppeteer-render/./helpers.js","webpack://puppeteer-render/./pdfLogic.js","webpack://puppeteer-render/./renderLogic.js","webpack://puppeteer-render/external commonjs \"dotenv\"","webpack://puppeteer-render/external commonjs \"express\"","webpack://puppeteer-render/external commonjs \"express-handlebars\"","webpack://puppeteer-render/external commonjs \"fs\"","webpack://puppeteer-render/external commonjs \"handlebars\"","webpack://puppeteer-render/external commonjs \"path\"","webpack://puppeteer-render/external commonjs \"puppeteer\"","webpack://puppeteer-render/webpack/bootstrap","webpack://puppeteer-render/./index.js"],"sourcesContent":["module.exports = {\n    ifEquals: function (a, b, options) {\n        if (a === b) {\n            return options.fn(this);\n        } else {\n            return options.inverse(this);\n        }\n    },\n    groupBy: function (arr, selectedKey, options) {\n        let sortStore = [];\n        let filteredCategories = [];\n        if (arr != undefined) {\n            for (let i = 0; i < arr.length; i++) {\n                let currentCategory = arr[i][selectedKey];\n                let lastCategory = '';\n                if (i != 0) {\n                    lastCategory = arr[i - 1][selectedKey];\n                }\n                if (\n                    currentCategory != lastCategory &&\n                    filteredCategories.indexOf(currentCategory) === -1\n                ) {\n                    filteredCategories.push(currentCategory);\n                    let filteredArray = arr.filter((element) => {\n                        return element[selectedKey] == currentCategory;\n                    });\n                    sortStore.push(filteredArray);\n                }\n            }\n        }\n        sortStore.forEach((category) => {\n            let sortedCategory = category.sort((a, b) => {\n                return new Date(b.FechaVto) - new Date(a.FechaVto);\n            });\n            return sortedCategory;\n        });\n\n        return sortStore;\n    },\n    formatDate: function (timestamp) {\n        if (timestamp == '' || timestamp == null) {\n            return '';\n        }\n        let date = new Date(timestamp);\n        let simplified = new Intl.DateTimeFormat('es-AR').format(date);\n        return simplified;\n    },\n    compare: function (variableOne, comparator, variableTwo) {\n        if (eval(variableOne + comparator + variableTwo)) {\n            return true;\n        } else {\n            return false;\n        }\n    },\n    minus: function (value) {\n        let newValue = value * -1;\n        return newValue;\n    },\n    today: function () {\n        let today = Date.now();\n        let simplified = new Intl.DateTimeFormat('es-AR').format(today);\n        return simplified;\n    },\n    sumarSaldos: function (saldos) {\n        let total = 0;\n        if (saldos != undefined && saldos[0] != undefined) {\n            total =\n                saldos[0].SaldoCSTitular +\n                saldos[0].SaldoCSAdherente +\n                saldos[0].SaldoServicios +\n                saldos[0].SaldoCreditos;\n            if (saldos[0].ImporteSinAplicar) {\n                total -= saldos[0].ImporteSinAplicar;\n            }\n        }\n\n        return total;\n    },\n    format: function (number) {\n        let rounder = new Intl.NumberFormat('es-AR', {\n            style: 'decimal',\n            maximumFractionDigits: 0,\n            minimumFractionDigits: 0,\n        });\n        let formatter = new Intl.NumberFormat('es-AR', {\n            style: 'decimal',\n            minimumFractionDigits: 2,\n            maximumFractionDigits: 2,\n        });\n        let numString;\n        if (number % 1 == 0) {\n            numString = rounder.format(number);\n        } else {\n            numString = formatter.format(number);\n        }\n        let formated = numString.split(' ').join('');\n        return formated;\n    },\n    renderMin: function (variableOne, variableTwo) {\n        if (variableOne < variableTwo) {\n            return variableOne;\n        } else {\n            return variableTwo;\n        }\n    },\n};\n","const puppeteer = require('puppeteer');\n\nrequire('dotenv').config();\n\nconst pdfLogic = async (req) => {\n    const browser = await puppeteer.launch({\n        args: [\n            '--disable-setuid-sandbox',\n            '--no-sandbox',\n            '--single-process',\n            '--no-zygote',\n        ],\n        executablePath:\n            process.env.NODE_ENV === 'production' &&\n            process.env.NODE_SERVER === 'render'\n                ? process.env.PUPPETEER_EXECUTABLE_PATH\n                : process.env.PUPPETEER_ALT_PATH,\n    });\n    try {\n        console.log('trying to make a PDF');\n        const page = await browser.newPage();\n\n        // await page.setContent('<html><body><h1>HOLA</h1></body></html>');\n        const htmlContent = req.body.html;\n        await page.setContent(htmlContent, {\n            waitUntil: 'networkidle0',\n        });\n        await page.setViewport({ width: 1440, height: 1880 });\n        await page.emulateMediaType('screen');\n\n        const file = await page.pdf({\n            format: 'A4',\n            printBackground: true,\n        });\n\n        await browser.close();\n        return file;\n        // res.send('ok');\n    } catch (e) {\n        console.error(e);\n    } finally {\n        await browser.close();\n    }\n};\n\nmodule.exports = { pdfLogic };\n","const { readFile, readFileSync } = require('fs');\nconst path = require('path');\n\nmodule.exports = async function (templateName, dataObject) {\n    const Handlebars = require('handlebars');\n    let templatePath = path.join(__dirname, 'templates', templateName) + '.hbs';\n    const content = readFileSync(templatePath, { encodig: 'utf8' });\n    Handlebars.registerHelper('sumarSaldos', (saldos) => {\n        let total = 0;\n        if (saldos != undefined && saldos[0] != undefined) {\n            total =\n                saldos[0].SaldoCSTitular +\n                saldos[0].SaldoCSAdherente +\n                saldos[0].SaldoServicios +\n                saldos[0].SaldoCreditos;\n            if (saldos[0].ImporteSinAplicar) {\n                total -= saldos[0].ImporteSinAplicar;\n            }\n        }\n\n        return total;\n    });\n    Handlebars.registerHelper('renderMin', function (variableOne, variableTwo) {\n        if (variableOne < variableTwo) {\n            return variableOne;\n        } else {\n            return variableTwo;\n        }\n    });\n    Handlebars.registerHelper('format', function (number) {\n        let rounder = new Intl.NumberFormat('es-AR', {\n            style: 'decimal',\n            maximumFractionDigits: 0,\n            minimumFractionDigits: 0,\n        });\n        let formatter = new Intl.NumberFormat('es-AR', {\n            style: 'decimal',\n            minimumFractionDigits: 2,\n            maximumFractionDigits: 2,\n        });\n        let numString;\n        if (number % 1 == 0) {\n            numString = rounder.format(number);\n        } else {\n            numString = formatter.format(number);\n        }\n        let formated = numString.split(' ').join('');\n        return formated;\n    });\n    Handlebars.registerHelper('formatDate', (timestamp) => {\n        if (timestamp == '' || timestamp == null) {\n            return '';\n        }\n        let date = new Date(timestamp);\n        let simplified = new Intl.DateTimeFormat('es-AR').format(date);\n        return simplified;\n    });\n    Handlebars.registerHelper('groupBy', function (arr, selectedKey, options) {\n        let sortStore = [];\n        let filteredCategories = [];\n        if (arr != undefined) {\n            for (let i = 0; i < arr.length; i++) {\n                let currentCategory = arr[i][selectedKey];\n                let lastCategory = '';\n                if (i != 0) {\n                    lastCategory = arr[i - 1][selectedKey];\n                }\n                if (\n                    currentCategory != lastCategory &&\n                    filteredCategories.indexOf(currentCategory) === -1\n                ) {\n                    filteredCategories.push(currentCategory);\n                    let filteredArray = arr.filter((element) => {\n                        return element[selectedKey] == currentCategory;\n                    });\n                    sortStore.push(filteredArray);\n                }\n            }\n        }\n        sortStore.forEach((category) => {\n            let sortedCategory = category.sort((a, b) => {\n                return new Date(b.FechaVto) - new Date(a.FechaVto);\n            });\n            return sortedCategory;\n        });\n\n        return sortStore;\n    });\n    Handlebars.registerHelper('ifEquals', function (a, b, options) {\n        if (a === b) {\n            return options.fn(this);\n        } else {\n            return options.inverse(this);\n        }\n    });\n    Handlebars.registerHelper(\n        'compare',\n        function (variableOne, comparator, variableTwo) {\n            if (eval(variableOne + comparator + variableTwo)) {\n                return true;\n            } else {\n                return false;\n            }\n        }\n    );\n    Handlebars.registerHelper('minus', function (value) {\n        let newValue = value * -1;\n        return newValue;\n    });\n    Handlebars.registerHelper('today', function () {\n        let today = Date.now();\n        let simplified = new Intl.DateTimeFormat('es-AR').format(today);\n        return simplified;\n    });\n    const template = Handlebars.compile(`${content}`);\n    const html = template(dataObject);\n    return html;\n};\n","module.exports = require(\"dotenv\");","module.exports = require(\"express\");","module.exports = require(\"express-handlebars\");","module.exports = require(\"fs\");","module.exports = require(\"handlebars\");","module.exports = require(\"path\");","module.exports = require(\"puppeteer\");","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","const express = require('express');\nrequire('dotenv').config();\nconst app = express();\n\nconst exphbs = require('express-handlebars');\nconst hbs = exphbs.create({\n    helpers: require('./helpers'),\n    extname: '.hbs',\n    defaultLayout: false,\n});\n\nconst path = require('path');\nconst { pdfLogic } = require('./pdfLogic');\nconst renderLogic = require('./renderLogic');\nconst token = process.env.API_TOKEN;\n\nconst PORT = process.env.PORT || 4000;\nfunction filterDates(userData) {\n    let servicesArr = userData.serviciosRepositorio;\n    let data = servicesArr.filter((service) => {\n        console.log(userData);\n        let string = service.FechaVto;\n        let dateToCheck = new Date(string);\n        // console.log('Date to check is:', dateToCheck);\n        let today = new Date();\n\n        // console.log('Today is:', today);\n\n        let check =\n            dateToCheck < today ||\n            dateToCheck.getUTCMonth() == today.getUTCMonth();\n        // console.log(check);\n        return check;\n    });\n    userData.serviciosRepositorio = data;\n    return userData;\n}\napp.engine('.hbs', hbs.engine);\napp.engine('.html', hbs.engine);\n\napp.use(express.json());\n\napp.set('view engine', 'hbs');\napp.set('views', path.join(__dirname, 'templates'));\napp.use(express.urlencoded({ extended: true }));\napp.use(express.static(path.join(__dirname, 'public')));\n\napp.get('/', (req, res) => {\n    res.sendFile(path.join(__dirname, 'index.html'));\n});\napp.get('/:id', async (req, res) => {\n    const id = req.params.id;\n    const data = await fetch(\n        `https://sistema.mundoamtae.com/alianzas/Api/SalesForce/GetReporteEstadoCuenta/${token}/${id}`\n    );\n\n    if (data.status == 200) {\n        const content = await data.json();\n\n        let newData = filterDates(content);\n        res.render('estado-de-cuenta', newData);\n    } else if (data.status == 400) {\n        console.log(data);\n    }\n});\napp.get('/:id/pdf/', async (req, res) => {\n    const id = req.params.id;\n    const data = await fetch(\n        `https://sistema.mundoamtae.com/alianzas/Api/SalesForce/GetReporteEstadoCuenta/${token}/${id}`\n    );\n\n    if (data.status == 200) {\n        const templateName = 'estado-de-cuenta';\n        const content = await data.json();\n        let newData = filterDates(content);\n        const html = await renderLogic(templateName, newData);\n        req.body.html = html;\n        const pdf = await pdfLogic(req);\n        res.set('content-type', 'application/pdf');\n        res.send(pdf);\n    } else if (data.status == 400) {\n        console.log(data);\n    }\n});\napp.get('/:id/ampliar', async (req, res) => {\n    const id = req.params.id;\n    const data = await fetch(\n        `https://sistema.mundoamtae.com/alianzas/Api/SalesForce/GetReporteEstadoCuenta/${token}/${id}`\n    );\n\n    if (data.status == 200) {\n        const content = await data.json();\n        let newData = filterDates(content);\n        res.render('estado-de-cuenta-ampliado', newData);\n    } else if (data.status == 400) {\n        console.log(data);\n    }\n});\napp.get('/:id/ampliar/pdf/', async (req, res) => {\n    const id = req.params.id;\n    const data = await fetch(\n        `https://sistema.mundoamtae.com/alianzas/Api/SalesForce/GetReporteEstadoCuenta/${token}/${id}`\n    );\n\n    if (data.status == 200) {\n        const templateName = 'estado-de-cuenta-ampliado';\n        const content = await data.json();\n        let newData = filterDates(content);\n        const html = await renderLogic(templateName, newData);\n        req.body.html = html;\n        const pdf = await pdfLogic(req);\n        res.set('content-type', 'application/pdf');\n        res.send(pdf);\n    } else if (data.status == 400) {\n        console.log(data);\n    }\n});\n\napp.listen(PORT, () => {\n    console.log(`Listening on port ${PORT}`);\n});\n"],"names":["module","exports","ifEquals","a","b","options","fn","this","inverse","groupBy","arr","selectedKey","sortStore","filteredCategories","undefined","i","length","currentCategory","lastCategory","indexOf","push","filteredArray","filter","element","forEach","category","sort","Date","FechaVto","formatDate","timestamp","date","Intl","DateTimeFormat","format","compare","variableOne","comparator","variableTwo","eval","minus","value","today","now","sumarSaldos","saldos","total","SaldoCSTitular","SaldoCSAdherente","SaldoServicios","SaldoCreditos","ImporteSinAplicar","number","numString","rounder","NumberFormat","style","maximumFractionDigits","minimumFractionDigits","formatter","split","join","renderMin","puppeteer","pdfLogic","async","req","browser","launch","args","executablePath","process","env","NODE_SERVER","PUPPETEER_EXECUTABLE_PATH","PUPPETEER_ALT_PATH","console","log","page","newPage","htmlContent","body","html","setContent","waitUntil","setViewport","width","height","emulateMediaType","file","pdf","printBackground","close","e","error","path","templateName","dataObject","Handlebars","templatePath","__dirname","content","readFileSync","encodig","registerHelper","template","compile","require","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","__webpack_modules__","express","app","exphbs","hbs","create","helpers","extname","defaultLayout","renderLogic","token","API_TOKEN","PORT","filterDates","userData","data","serviciosRepositorio","service","string","dateToCheck","getUTCMonth","engine","use","json","set","urlencoded","extended","static","get","res","sendFile","id","params","fetch","status","newData","render","send","listen"],"sourceRoot":""}