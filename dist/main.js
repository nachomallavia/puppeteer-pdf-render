(()=>{var __webpack_modules__={920:module=>{module.exports={ifEquals:function(e,t,a){return e===t?a.fn(this):a.inverse(this)},multiply:function(e,t){return e*t},groupBy:function(e,t,a){let r=[],n=[];if(null!=e){for(let o=0;o<e.length;o++){let i=e[o][t],s=e[o][a],l="",c="";if(0!=o&&(l=e[o-1][t],c=e[o-1][a]),i+s!=l+c&&-1===n.indexOf(i+s)){n.push(i+s);let o=e.filter((e=>e[t]==i&&e[a]==s));r.push(o)}}r.forEach((e=>e.sort(((e,t)=>new Date(t.FechaVto)-new Date(e.FechaVto)))))}return r},formatDate:function(e){if(""==e||null==e)return"";let t=new Date(e);return new Intl.DateTimeFormat("es-AR").format(t)},compare:function(variableOne,comparator,variableTwo){return!!eval(variableOne+comparator+variableTwo)},minus:function(e){return-1*e},today:function(){let e=Date.now();return new Intl.DateTimeFormat("es-AR").format(e)},sumarSaldos:function(e){let t=0;return null!=e&&null!=e[0]&&(t=e[0].SaldoCSTitular+e[0].SaldoCSAdherente+e[0].SaldoServicios+e[0].SaldoCreditos,e[0].ImporteSinAplicar&&(t-=e[0].ImporteSinAplicar)),t>0?t:0},format:function(e){let t,a=new Intl.NumberFormat("es-AR",{style:"decimal",maximumFractionDigits:0,minimumFractionDigits:0}),r=new Intl.NumberFormat("es-AR",{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2});return t=e%1==0?a.format(e):r.format(e),t.split(" ").join("")},renderMin:function(e,t){return e<t?e:t}}},445:(e,t,a)=>{const r=a(758);a(818).config(),e.exports={pdfLogic:async e=>{const t=await r.launch({args:["--disable-setuid-sandbox","--no-sandbox","--single-process","--no-zygote"],executablePath:"render"===process.env.NODE_SERVER?process.env.PUPPETEER_EXECUTABLE_PATH:process.env.PUPPETEER_ALT_PATH});try{console.log("trying to make a PDF");const a=await t.newPage(),r=e.body.html;await a.setContent(r,{waitUntil:"networkidle0"}),await a.setViewport({width:1440,height:1880}),await a.emulateMediaType("screen");const n=await a.pdf({format:"A4",printBackground:!0,margin:{top:10}});return await t.close(),n}catch(e){console.error(e)}finally{await t.close()}}}},279:(module,__unused_webpack_exports,__webpack_require__)=>{const{readFile,readFileSync}=__webpack_require__(383),path=__webpack_require__(3);module.exports=async function(templateName,dataObject){const Handlebars=__webpack_require__(156);let templatePath=path.join(__dirname,"templates",templateName)+".hbs";const content=readFileSync(templatePath,{encodig:"utf8"});Handlebars.registerHelper("sumarSaldos",(e=>{let t=0;return null!=e&&null!=e[0]&&(t=e[0].SaldoCSTitular+e[0].SaldoCSAdherente+e[0].SaldoServicios+e[0].SaldoCreditos,e[0].ImporteSinAplicar&&(t-=e[0].ImporteSinAplicar)),t>0?t:0})),Handlebars.registerHelper("renderMin",(function(e,t){return e<t?e:t})),Handlebars.registerHelper("format",(function(e){let t,a=new Intl.NumberFormat("es-AR",{style:"decimal",maximumFractionDigits:0,minimumFractionDigits:0}),r=new Intl.NumberFormat("es-AR",{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2});return t=e%1==0?a.format(e).toString():r.format(e).toString(),null==e&&(t="0"),t.split(" ").join("")})),Handlebars.registerHelper("formatDate",(e=>{if(""==e||null==e)return"";let t=new Date(e);return new Intl.DateTimeFormat("es-AR").format(t)})),Handlebars.registerHelper("groupBy",(function(e,t,a){let r=[],n=[];if(null!=e){for(let o=0;o<e.length;o++){let i=e[o][t],s=e[o][a],l="",c="";if(0!=o&&(l=e[o-1][t],c=e[o-1][a]),i+s!=l+c&&-1===n.indexOf(i+s)){n.push(i+s);let o=e.filter((e=>e[t]==i&&e[a]==s));r.push(o)}}r.forEach((e=>e.sort(((e,t)=>new Date(t.FechaVto)-new Date(e.FechaVto)))))}return r})),Handlebars.registerHelper("ifEquals",(function(e,t,a){return e===t?a.fn(this):a.inverse(this)})),Handlebars.registerHelper("compare",(function(variableOne,comparator,variableTwo){return!!eval(variableOne+comparator+variableTwo)})),Handlebars.registerHelper("minus",(function(e){let t=-1*e;return t>0?t:0})),Handlebars.registerHelper("today",(function(){let e=Date.now();return new Intl.DateTimeFormat("es-AR").format(e)}));const template=Handlebars.compile(`${content}`),html=template(dataObject);return html}},818:e=>{"use strict";e.exports=require("dotenv")},252:e=>{"use strict";e.exports=require("express")},707:e=>{"use strict";e.exports=require("express-handlebars")},383:e=>{"use strict";e.exports=require("fs")},156:e=>{"use strict";e.exports=require("handlebars")},3:e=>{"use strict";e.exports=require("path")},758:e=>{"use strict";e.exports=require("puppeteer")}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var a=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](a,a.exports,__webpack_require__),a.exports}const express=__webpack_require__(252);__webpack_require__(818).config();const app=express(),exphbs=__webpack_require__(707),hbs=exphbs.create({helpers:__webpack_require__(920),extname:".hbs",defaultLayout:!1}),path=__webpack_require__(3),{pdfLogic}=__webpack_require__(445),renderLogic=__webpack_require__(279),token=process.env.API_TOKEN,PORT=process.env.PORT||4e3;function filterDates(e){let t=e.serviciosRepositorio;if(null!=t){let a=t.filter((t=>{console.log(e);let a=t.FechaVto,r=new Date(a),n=new Date;return r<n||r.getUTCMonth()==n.getUTCMonth()}));e.serviciosRepositorio=a}return e}function calcularMora(e){let t=e.creditosAdministrados;return t.forEach((e=>{"Mora"==e.Estado&&(e.Mora=e.ValorCuota*e.Cuotas_Impagas)})),e.creditosAdministrados=t,e}app.engine(".hbs",hbs.engine),app.engine(".html",hbs.engine),app.use(express.json()),app.set("view engine","hbs"),app.set("views",path.join(__dirname,"templates")),app.use(express.urlencoded({extended:!0})),app.use(express.static(path.join(__dirname,"public"))),app.get("/",((e,t)=>{t.sendFile(path.join(__dirname,"index.html"))})),app.get("/:id",(async(e,t)=>{const a=e.params.id,r=await fetch(`https://sistema.mundoamtae.com/alianzas/Api/SalesForce/GetReporteEstadoCuenta/${token}/${a}`);if(200==r.status){const e=await r.json();console.log(e);let a=filterDates(e);t.render("estado-de-cuenta",a)}else 400==r.status&&console.log(r)})),app.get("/:id/pdf/",(async(e,t)=>{const a=e.params.id,r=await fetch(`https://sistema.mundoamtae.com/alianzas/Api/SalesForce/GetReporteEstadoCuenta/${token}/${a}`);if(200==r.status){const a="estado-de-cuenta";let n=filterDates(await r.json());const o=await renderLogic(a,n);e.body.html=o;const i=await pdfLogic(e);t.set("content-type","application/pdf"),t.send(i)}else 400==r.status&&console.log(r)})),app.get("/:id/ampliar",(async(e,t)=>{const a=e.params.id,r=await fetch(`https://sistema.mundoamtae.com/alianzas/Api/SalesForce/GetReporteEstadoCuenta/${token}/${a}`);if(200==r.status){let e=filterDates(await r.json());t.render("estado-de-cuenta-ampliado",e)}else 400==r.status&&console.log(r)})),app.get("/:id/ampliar/pdf/",(async(e,t)=>{const a=e.params.id,r=await fetch(`https://sistema.mundoamtae.com/alianzas/Api/SalesForce/GetReporteEstadoCuenta/${token}/${a}`);if(200==r.status){const a="estado-de-cuenta-ampliado";let n=filterDates(await r.json());const o=await renderLogic(a,n);e.body.html=o;const i=await pdfLogic(e);t.set("content-type","application/pdf"),t.send(i)}else 400==r.status&&console.log(r)})),app.listen(PORT,(()=>{console.log(`Listening on port ${PORT}`)}))})();
//# sourceMappingURL=main.js.map